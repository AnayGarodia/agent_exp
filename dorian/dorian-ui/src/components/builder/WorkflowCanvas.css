/* ========================================
   SCRATCH-STYLE WORKSPACE CANVAS
   ======================================== */

/* Main canvas container */
.workflow-canvas {
  width: 100%;
  height: 100%;
  position: relative;
  background: var(--canvas-bg, #F9F9F9);
  overflow: hidden;
  isolation: isolate;
  touch-action: pan-x pan-y;
}

/* Blockly workspace fills the canvas */
.workflow-canvas__blockly {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
}

/* ========================================
   ZOOM CONTROLS — Bottom-right floating
   ======================================== */

.workflow-canvas__controls {
  position: fixed;
  bottom: 1.5rem;
  right: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.375rem;
  background: var(--color-surface, #FFFFFF);
  border: 2px solid var(--color-border, #DCDCDC);
  border-radius: var(--radius-xl, 1.5rem);
  padding: 0.5rem;
  box-shadow: var(--shadow-lg);
  z-index: 1000;
  pointer-events: auto;
}

.workflow-canvas__controls button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  background: transparent;
  border: none;
  border-radius: var(--radius-md, 0.625rem);
  color: var(--color-text-secondary, #575757);
  cursor: pointer;
  transition: all 0.15s ease;
}

.workflow-canvas__controls button:hover {
  background: var(--color-bg-secondary, #E8E8E8);
  color: var(--color-text, #2E2E2E);
  transform: translateY(-1px);
}

.workflow-canvas__controls button:active {
  transform: translateY(0);
}

.workflow-canvas__clear {
  color: #E05050 !important;
}

.workflow-canvas__clear:hover {
  background: rgba(224, 80, 80, 0.1) !important;
  color: #D03030 !important;
}

.workflow-canvas__divider {
  width: 1px;
  height: 24px;
  background: var(--color-border, #DCDCDC);
  margin: 0 0.125rem;
}

/* ========================================
   BLOCKLY TOOLBOX — Scratch-style sidebar
   NEVER affected by workspace zoom
   ======================================== */

.blocklyToolboxDiv {
  background: var(--color-surface, #FFFFFF) !important;
  border-right: 2px solid var(--color-border, #DCDCDC) !important;
  box-shadow: 2px 0 12px rgba(0, 0, 0, 0.06) !important;
  padding: 0.75rem 0.375rem !important;
  position: absolute !important;
  left: 0 !important;
  top: 0 !important;
  z-index: 500 !important;
  transform: none !important;
  zoom: 1 !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
}

/* Hide scrollbar but keep functionality */
.blocklyToolboxDiv::-webkit-scrollbar {
  width: 6px !important;
}

.blocklyToolboxDiv::-webkit-scrollbar-track {
  background: transparent !important;
}

.blocklyToolboxDiv::-webkit-scrollbar-thumb {
  background: var(--color-border, #DCDCDC) !important;
  border-radius: 3px !important;
}

.blocklyToolboxDiv::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-tertiary, #9B9B9B) !important;
}

/* Category rows */
.blocklyTreeRow {
  padding: 0.75rem 1rem !important;
  border-radius: var(--radius-lg, 1rem) !important;
  margin: 0.25rem 0.375rem !important;
  cursor: pointer !important;
  transition: all 0.15s ease !important;
  border: 2px solid transparent !important;
  min-height: 44px !important;
  display: flex !important;
  align-items: center !important;
}

.blocklyTreeRow:hover {
  background: var(--color-bg-secondary, #E8E8E8) !important;
  border-color: transparent !important;
  transform: translateX(2px) !important;
}

.blocklyTreeRow.blocklyTreeSelected {
  background: rgba(76, 151, 255, 0.12) !important;
  border-color: rgba(76, 151, 255, 0.3) !important;
}

/* Category labels */
.blocklyTreeLabel {
  color: var(--color-text, #2E2E2E) !important;
  font-size: 0.9rem !important;
  font-weight: 600 !important;
  font-family: var(--font-body) !important;
  letter-spacing: 0.02em !important;
}

/* Category color swatches */
.blocklyTreeIcon {
  width: 22px !important;
  height: 22px !important;
  margin-right: 0.625rem !important;
  border-radius: var(--radius-sm, 0.375rem) !important;
}

/* Flyout (blocks panel when category is clicked) */
.blocklyFlyout {
  background: var(--color-bg, #F0F0F0) !important;
}

.blocklyFlyoutBackground {
  fill: var(--color-bg, #F0F0F0) !important;
  fill-opacity: 0.98 !important;
}

.blocklyFlyoutScrollbar {
  display: none !important;
  visibility: hidden !important;
}

/* Category separator */
.blocklyTreeSeparator {
  border-bottom: 1px solid var(--color-border, #DCDCDC) !important;
  margin: 0.5rem 0.375rem !important;
}

/* ========================================
   BLOCKLY SCROLLBARS
   ======================================== */

/* Scrollbar background - nearly invisible */
.blocklyScrollbarBackground {
  fill: transparent !important;
  fill-opacity: 0 !important;
  stroke: none !important;
  rx: 6 !important;
  ry: 6 !important;
}

/* Scrollbar handle - very subtle, only visible on hover */
.blocklyScrollbarHandle {
  fill: rgba(140, 140, 140, 0.15) !important;
  fill-opacity: 1 !important;
  stroke: none !important;
  rx: 6 !important;
  ry: 6 !important;
  cursor: pointer !important;
  transition: fill 0.2s ease !important;
}

.blocklyScrollbarHandle:hover {
  fill: rgba(106, 4, 29, 0.5) !important;
}

.blocklyScrollbarCorner {
  fill: transparent !important;
}

/* Workspace main background */
.blocklyMainBackground {
  stroke: var(--color-border, #DCDCDC) !important;
  stroke-width: 0 !important;
}

/* ========================================
   BLOCKLY BLOCKS — Scratch-style appearance
   ======================================== */

/* Remove shadows for seamless block connection */
.blocklyBlockCanvas .blocklyDraggable,
.blocklyBlockCanvas .blocklyPath,
.blocklyBlockCanvas .blocklyBlockBackground,
.blocklyDragging {
  filter: none !important;
}

/* Ensure tight block connections with no gaps */
.blocklyPath {
  stroke-width: 0 !important;
}

/* Remove gaps in block connections */
.blocklyBlockCanvas > g {
  shape-rendering: crispEdges;
}

/* Ensure blocks snap tightly */
.blocklyInsertionMarker > .blocklyPath {
  stroke: none !important;
  fill-opacity: 0.4 !important;
}

/* Block text fields */
.blocklyEditableText > rect {
  fill: rgba(255, 255, 255, 0.25) !important;
  stroke: rgba(255, 255, 255, 0.3) !important;
  rx: 8 !important;
  ry: 8 !important;
}

.blocklyEditableText > text {
  fill: #FFFFFF !important;
  font-family: var(--font-body) !important;
  font-size: 13px !important;
  font-weight: 600 !important;
}

/* Dark text on all pastel blocks for good contrast */
.blocklyText {
  fill: #2A2A2A !important;
  font-weight: 600 !important;
  text-shadow: 0 1px 3px rgba(255, 255, 255, 0.6);
}

/* Editable text fields also get dark text */
.blocklyEditableText > text {
  fill: #2A2A2A !important;
  font-weight: 600 !important;
  text-shadow: 0 1px 3px rgba(255, 255, 255, 0.6);
}

/* Input field backgrounds - slightly darker for contrast */
.blocklyEditableText > rect {
  fill: rgba(0, 0, 0, 0.08) !important;
  stroke: rgba(0, 0, 0, 0.15) !important;
  rx: 8 !important;
  ry: 8 !important;
}

/* Dropdown menus */
.blocklyDropDownDiv {
  background: var(--color-surface, #FFFFFF) !important;
  border: 2px solid var(--color-border, #DCDCDC) !important;
  border-radius: var(--radius-lg, 1rem) !important;
  box-shadow: var(--shadow-lg) !important;
  z-index: 2000 !important;
}

/* Connection indicators */
.blocklyInsertionMarker {
  opacity: 0.4 !important;
}

/* ========================================
   PASTEL CATEGORY ICON GRADIENTS
   ======================================== */

/* Control - Peach */
.blocklyTreeRow[data-id*="control"] .blocklyTreeIcon {
  background: linear-gradient(135deg, #FFB366 0%, #FFC999 100%) !important;
  box-shadow: 0 2px 6px rgba(255, 179, 102, 0.3) !important;
}

/* Input - Aqua */
.blocklyTreeRow[data-id*="input"] .blocklyTreeIcon {
  background: linear-gradient(135deg, #66E0E0 0%, #99EBEB 100%) !important;
  box-shadow: 0 2px 6px rgba(102, 224, 224, 0.3) !important;
}

/* Gmail - Lemon Yellow */
.blocklyTreeRow[data-id*="gmail"] .blocklyTreeIcon {
  background: linear-gradient(135deg, #FFD666 0%, #FFE699 100%) !important;
  box-shadow: 0 2px 6px rgba(255, 214, 102, 0.3) !important;
}

/* AI - Medium Purple */
.blocklyTreeRow[data-id*="ai"] .blocklyTreeIcon {
  background: linear-gradient(135deg, #B399FF 0%, #CCB3FF 100%) !important;
  box-shadow: 0 2px 6px rgba(179, 153, 255, 0.3) !important;
}

/* Data - Mint Green */
.blocklyTreeRow[data-id*="data"] .blocklyTreeIcon {
  background: linear-gradient(135deg, #A3E6A3 0%, #C2F0C2 100%) !important;
  box-shadow: 0 2px 6px rgba(163, 230, 163, 0.3) !important;
}

/* Output - Sky Blue */
.blocklyTreeRow[data-id*="output"] .blocklyTreeIcon {
  background: linear-gradient(135deg, #85C1FF 0%, #A8D4FF 100%) !important;
  box-shadow: 0 2px 6px rgba(133, 193, 255, 0.3) !important;
}

/* Utility - Coral */
.blocklyTreeRow[data-id*="utility"] .blocklyTreeIcon {
  background: linear-gradient(135deg, #FF9999 0%, #FFB3B3 100%) !important;
  box-shadow: 0 2px 6px rgba(255, 153, 153, 0.3) !important;
}

/* ========================================
   DARK MODE (workspace switches theme)
   ======================================== */

[data-theme="dark"] .workflow-canvas {
  background: var(--canvas-bg-dark, #1E1E2E);
}

[data-theme="dark"] .blocklyToolboxDiv {
  background: var(--color-dark-surface, #2A2A3D) !important;
  border-right-color: var(--color-dark-border, #3A3A52) !important;
  box-shadow: 2px 0 12px rgba(0, 0, 0, 0.2) !important;
}

[data-theme="dark"] .blocklyTreeRow:hover {
  background: rgba(255, 255, 255, 0.06) !important;
}

[data-theme="dark"] .blocklyTreeRow.blocklyTreeSelected {
  background: rgba(76, 151, 255, 0.15) !important;
  border-color: rgba(76, 151, 255, 0.25) !important;
}

[data-theme="dark"] .blocklyTreeLabel {
  color: var(--color-dark-text, #E8E8F0) !important;
}

[data-theme="dark"] .blocklyFlyout {
  background: var(--color-dark-bg-secondary, #252536) !important;
}

[data-theme="dark"] .blocklyFlyoutBackground {
  fill: var(--color-dark-bg-secondary, #252536) !important;
}

[data-theme="dark"] .workflow-canvas__controls {
  background: var(--color-dark-surface, #2A2A3D);
  border-color: var(--color-dark-border, #3A3A52);
}

[data-theme="dark"] .workflow-canvas__controls button {
  color: var(--color-dark-text-secondary, #A8A8C0);
}

[data-theme="dark"] .workflow-canvas__controls button:hover {
  background: rgba(255, 255, 255, 0.08);
  color: var(--color-dark-text, #E8E8F0);
}

[data-theme="dark"] .blocklyMainBackground {
  fill: var(--canvas-bg-dark, #1E1E2E) !important;
}

[data-theme="dark"] .blocklyScrollbarBackground {
  fill: transparent !important;
  fill-opacity: 0 !important;
}

[data-theme="dark"] .blocklyScrollbarHandle {
  fill: rgba(255, 255, 255, 0.1) !important;
}

[data-theme="dark"] .blocklyScrollbarHandle:hover {
  fill: rgba(212, 70, 110, 0.5) !important;
}

[data-theme="dark"] .blocklyDropDownDiv {
  background: var(--color-dark-surface, #2A2A3D) !important;
  border-color: var(--color-dark-border, #3A3A52) !important;
}

/* ========================================
   RESPONSIVE
   ======================================== */

@media (max-width: 768px) {
  .blocklyToolboxDiv {
    width: 180px !important;
  }

  .workflow-canvas__controls {
    bottom: 1rem;
    right: 1rem;
    padding: 0.375rem;
  }

  .workflow-canvas__controls button {
    width: 32px;
    height: 32px;
  }
}
